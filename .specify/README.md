# .specify 目录说明

本目录包含项目的核心治理文档和模板，用于确保项目开发过程的一致性和质量。

## 目录结构

```
.specify/
├── memory/
│   └── constitution.md          # 项目宪章（核心治理文档）
├── templates/
│   ├── spec-template.md         # 功能规格说明书模板
│   ├── tasks-template.md        # 任务列表模板
│   ├── plan-template.md         # 实施计划模板
│   └── commands/                # 自定义命令模板（待创建）
└── README.md                    # 本文件
```

## 核心文档

### 1. 项目宪章 (constitution.md)

项目宪章是项目的"法律"文档，定义了：
- 6 项核心开发原则
- 技术栈约束
- 架构要求
- 治理与修订流程

**所有代码和设计决策必须符合宪章规定。**

当前版本: 1.0.0
批准日期: 2025-10-26

#### 核心原则速查

1. **极简主义设计**: Apple 风格，简洁至上
2. **安全优先**: 多层权限控制（RLS + 代码层）
3. **强制质量保证**: 测试和审查是交付标准
4. **类型安全**: TypeScript 严格模式，避免 `any`
5. **性能优先**: Server Components 优先，优化查询
6. **数据一致性**: 外键约束，可逆迁移

## 模板使用指南

### 2. 功能规格说明书 (spec-template.md)

**何时使用**: 在开始开发任何新功能前，使用此模板编写详细的功能规格。

**使用流程**:
1. 复制 `spec-template.md` 到项目根目录或 `/docs` 目录
2. 重命名为 `[FEATURE_ID]-spec.md`（如 `F-AUTH-01-spec.md`）
3. 填写所有必需部分（用户故事、技术设计、宪章合规性检查等）
4. 提交审查并获得批准后开始开发

**关键部分**:
- **宪章合规性检查**: 确保功能符合 6 项核心原则
- **技术设计**: 数据模型、RLS 策略、API 设计
- **测试计划**: 单元测试、集成测试、权限测试

### 3. 实施计划 (plan-template.md)

**何时使用**: 在功能规格批准后，使用此模板制定详细的实施计划。

**使用流程**:
1. 复制 `plan-template.md` 到项目根目录或 `/docs` 目录
2. 重命名为 `[FEATURE_ID]-plan.md`
3. 填写实施阶段、资源分配、时间线、风险管理等
4. 获得技术负责人和项目管理员批准后执行

**关键部分**:
- **宪章合规性检查**: 每个原则的合规性说明
- **实施阶段**: 6 个标准阶段（数据库 → 类型 → Actions → UI → 测试 → 部署）
- **风险管理**: 识别潜在风险并制定缓解措施

### 4. 任务列表 (tasks-template.md)

**何时使用**: 在实施计划批准后，使用此模板生成可执行的任务列表。

**使用流程**:
1. 复制 `tasks-template.md` 到项目根目录或 `/docs` 目录
2. 重命名为 `[FEATURE_ID]-tasks.md`
3. 根据实施计划填写具体任务
4. 在开发过程中实时更新任务状态

**任务状态**:
- ⬜ 未开始
- 🔄 进行中
- ✅ 已完成
- ⚠️ 阻塞

**关键部分**:
- **第一阶段**: 数据库设计与迁移
- **第五阶段**: 测试与质量保证（包含强制的质量保证流程）
- **完成检查清单**: 确保所有宪章合规性要求已满足

## 开发工作流

推荐的功能开发工作流：

```
1. 编写功能规格 (spec.md)
   ↓
2. 宪章合规性检查
   ↓
3. 规格审查与批准
   ↓
4. 制定实施计划 (plan.md)
   ↓
5. 计划审查与批准
   ↓
6. 生成任务列表 (tasks.md)
   ↓
7. 执行开发任务
   ↓
8. 强制质量保证流程
   - 单元测试（覆盖率 ≥ 80%）
   - 代码审查（使用 feature-dev:code-reviewer）
   - 问题修复
   ↓
9. 部署到生产环境
   ↓
10. 标记功能完成
```

## 质量保证强制流程

根据宪章**原则 3: 强制质量保证**，每个功能模块必须通过以下流程：

1. **单元测试**
   - 使用专门的测试工具或子代理
   - 测试所有新增的函数和组件
   - 覆盖率目标 ≥ 80%

2. **代码审查**
   - 使用 `feature-dev:code-reviewer` 子代理
   - 检查代码质量、安全漏洞、最佳实践
   - 验证权限控制实现

3. **问题修复**
   - 立即修复发现的问题
   - 重新测试和审查

4. **完成确认**
   - 只有测试和审查都通过后，功能才被视为完成

**禁止跳过任何步骤！**

## 宪章修订流程

如果需要修订项目宪章：

1. **提议**: 通过 Issue 或团队讨论提出修订建议
2. **评估**: 技术负责人评估必要性和影响范围
3. **审批**: 获得项目管理员批准
4. **实施**: 更新宪章版本号，同步更新所有模板

### 版本控制规则
- **MAJOR (X.0.0)**: 移除或重新定义核心原则
- **MINOR (0.X.0)**: 新增原则或技术栈约束
- **PATCH (0.0.X)**: 措辞澄清或错误修正

## 常见问题

### Q: 是否每个功能都需要编写规格说明书？
A: 是的。所有非琐碎的功能（超过简单的 UI 调整或配置更改）都需要规格说明书。这确保了设计的深思熟虑和团队的一致理解。

### Q: 如果时间紧迫，可以跳过质量保证流程吗？
A: 不可以。根据宪章原则 3，质量保证是交付标准，不是可选项。跳过质量保证会导致技术债务和潜在的生产事故。

### Q: 如何处理宪章与实际需求的冲突？
A: 首先尝试在宪章框架内找到解决方案。如果确实无法兼容，应启动宪章修订流程，而不是绕过宪章。

### Q: 宪章中的技术栈可以更改吗？
A: 技术栈约束是经过深思熟虑的决策，更改需要 MAJOR 版本升级。只有在有充分理由（如技术过时、重大性能问题）时才考虑更改。

## 联系与支持

如有关于 .specify 文档的问题或建议，请联系：
- 技术负责人: [待填写]
- 项目管理员: [待填写]

---

**最后更新**: 2025-10-26
**文档版本**: 1.0.0
