# 任务列表 (Task List)

**功能 ID**: [FEATURE_ID]
**功能名称**: [FEATURE_NAME]
**生成日期**: [YYYY-MM-DD]
**状态**: [未开始 | 进行中 | 已完成]

---

## 任务执行说明 (Task Execution Guidelines)

本任务列表基于功能规格说明书（spec.md）自动生成，并严格遵循项目宪章的原则。

### 执行顺序规则
1. 任务按依赖关系排序，必须按顺序执行
2. 每个任务完成后必须更新状态为 `✅ 已完成`
3. 遇到阻塞问题时标记为 `⚠️ 阻塞` 并记录原因
4. 所有任务完成后，必须执行质量保证流程

### 质量保证检查点
根据宪章**原则 3: 强制质量保证**，每个功能模块必须通过以下检查：
- [ ] 单元测试（覆盖率 ≥ 80%）
- [ ] 代码审查（使用 `feature-dev:code-reviewer`）
- [ ] 问题修复（如有）
- [ ] 最终确认

---

## 第一阶段: 数据库设计与迁移 (Database Design & Migration)

### Task 1.1: 设计数据表结构
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]

**描述**:
根据 spec.md 中的数据模型设计，创建完整的数据表结构。

**要求**:
- 定义所有字段类型和约束
- 添加外键关系（Foreign Keys）
- 包含 `created_at` 和 `updated_at` 时间戳
- 遵循**原则 6: 数据一致性**

**输出**:
- SQL 迁移文件: `supabase/migrations/[timestamp]_[feature_name].sql`

**验收标准**:
- [ ] 所有必需字段已定义
- [ ] 外键约束正确配置
- [ ] 字段类型符合业务需求

---

### Task 1.2: 编写 RLS 策略
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 1.1

**描述**:
根据权限矩阵编写 Row Level Security (RLS) 策略。

**要求**:
- 为每个表创建 SELECT、INSERT、UPDATE、DELETE 策略
- 遵循**原则 2: 安全优先**的权限要求
- 确保四种角色（管理员、观察员、项目负责人、项目成员）权限正确

**输出**:
- RLS 策略 SQL（包含在迁移文件中）

**验收标准**:
- [ ] 管理员权限: [具体权限]
- [ ] 观察员权限: [具体权限]
- [ ] 项目负责人权限: [具体权限]
- [ ] 项目成员权限: [具体权限]

---

### Task 1.3: 执行数据库迁移
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 1.2

**描述**:
在本地和远程 Supabase 环境执行迁移脚本。

**要求**:
- 在本地 Supabase 环境测试迁移
- 验证迁移可逆性（提供 rollback）
- 部署到远程 Supabase 项目

**验收标准**:
- [ ] 本地迁移成功
- [ ] 表结构符合预期
- [ ] RLS 策略生效
- [ ] 远程迁移成功

---

## 第二阶段: TypeScript 类型定义 (TypeScript Types)

### Task 2.1: 生成数据库类型
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 1.3

**描述**:
使用 Supabase CLI 自动生成 TypeScript 类型定义。

**要求**:
- 运行 `supabase gen types typescript --local > lib/types/database.types.ts`
- 遵循**原则 4: 类型安全**

**验收标准**:
- [ ] 类型文件生成成功
- [ ] 类型定义完整且无错误

---

### Task 2.2: 定义业务逻辑类型
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 2.1

**描述**:
定义表单输入、API 响应、组件 Props 等业务逻辑类型。

**要求**:
- 创建 `lib/types/[feature].types.ts`
- 禁止使用 `any` 类型
- 使用 Zod 进行运行时验证

**输出**:
```typescript
// 示例
export interface CreateTaskInput {
  title: string;
  description?: string;
  assignee_id: string;
  due_date?: string;
}

export const createTaskSchema = z.object({
  title: z.string().min(1).max(100),
  description: z.string().optional(),
  assignee_id: z.string().uuid(),
  due_date: z.string().datetime().optional(),
});
```

**验收标准**:
- [ ] 所有类型定义完整
- [ ] Zod 校验规则符合业务需求
- [ ] 无 TypeScript 编译错误

---

## 第三阶段: Server Actions 开发 (Server Actions)

### Task 3.1: 实现数据读取 Actions
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 2.2

**描述**:
实现获取数据的 Server Actions（如 `getTasks`, `getProjects`）。

**要求**:
- 创建 `lib/actions/[feature].actions.ts`
- 使用 Supabase Client 进行数据查询
- 依赖 RLS 策略进行权限控制
- 遵循**原则 5: 性能优先**（避免 N+1 查询）

**验收标准**:
- [ ] 所有读取操作正常
- [ ] RLS 策略生效（不同角色返回不同数据）
- [ ] 错误处理完善

---

### Task 3.2: 实现数据写入 Actions
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 3.1

**描述**:
实现创建、更新、删除数据的 Server Actions。

**要求**:
- 使用 Zod 验证输入数据
- 检查用户权限（双重验证：RLS + 代码层）
- 处理错误情况（如外键约束违反）
- 遵循**原则 2: 安全优先**

**验收标准**:
- [ ] 创建操作成功
- [ ] 更新操作成功
- [ ] 删除操作成功（含二次确认）
- [ ] 权限检查正确
- [ ] 错误信息清晰

---

## 第四阶段: UI 组件开发 (UI Components)

### Task 4.1: 实现基础 UI 组件
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 3.2

**描述**:
使用 shadcn/ui 实现功能所需的基础组件。

**要求**:
- 遵循**原则 1: 极简主义设计**
- 使用 Tailwind CSS 进行样式设计
- 确保组件可复用
- 添加 TypeScript 类型定义

**输出**:
- `components/features/[feature]/[ComponentName].tsx`

**验收标准**:
- [ ] 组件符合 Apple 设计风格
- [ ] 响应式设计（桌面优先）
- [ ] 无障碍访问支持（如适用）
- [ ] TypeScript 类型完整

---

### Task 4.2: 实现功能页面
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 4.1

**描述**:
实现功能的主页面（Server Components）。

**要求**:
- 使用 Next.js App Router
- 优先使用 Server Components
- 实现 Loading 和 Error 状态
- 遵循**原则 5: 性能优先**

**输出**:
- `app/(dashboard)/[route]/page.tsx`
- `app/(dashboard)/[route]/loading.tsx`
- `app/(dashboard)/[route]/error.tsx`

**验收标准**:
- [ ] 页面正常渲染
- [ ] 数据正确显示
- [ ] Loading 状态优雅
- [ ] 错误处理完善

---

### Task 4.3: 实现交互功能（Client Components）
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 4.2

**描述**:
实现需要客户端交互的功能（如表单、拖拽、模态框）。

**要求**:
- 使用 `'use client'` 指令
- 集成 Server Actions
- 实现乐观更新（Optimistic Updates，可选）
- 遵循**原则 1: 极简主义设计**

**验收标准**:
- [ ] 表单验证正确
- [ ] 提交成功后显示反馈
- [ ] 错误提示清晰
- [ ] 交互流程不超过 3 步

---

## 第五阶段: 测试与质量保证 (Testing & QA)

### Task 5.1: 编写单元测试
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 4.3

**描述**:
为所有新增的函数、Server Actions 和组件编写单元测试。

**要求**:
- 使用 Jest 或 Vitest 测试框架
- 覆盖边界条件和错误情况
- 目标覆盖率 ≥ 80%
- 遵循**原则 3: 强制质量保证**

**验收标准**:
- [ ] Server Actions 测试通过
- [ ] 组件测试通过
- [ ] 工具函数测试通过
- [ ] 测试覆盖率达标

---

### Task 5.2: 执行权限测试
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 5.1

**描述**:
使用不同角色的用户账号测试权限控制。

**要求**:
- 测试管理员、观察员、项目负责人、项目成员的权限边界
- 验证 RLS 策略和代码层权限检查
- 遵循**原则 2: 安全优先**

**测试矩阵**:
| 操作 | 管理员 | 观察员 | 负责人 | 成员 |
|------|--------|--------|--------|------|
| [操作 1] | ✅ | ❌ | ✅ | ❌ |
| [操作 2] | ✅ | ✅ | ✅ | ✅ |

**验收标准**:
- [ ] 所有权限测试通过
- [ ] 无越权访问漏洞

---

### Task 5.3: 执行代码审查
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 5.2

**描述**:
使用 `feature-dev:code-reviewer` 子代理进行代码审查。

**要求**:
- 检查代码质量、安全漏洞、最佳实践
- 验证是否符合项目宪章的所有原则
- 遵循**原则 3: 强制质量保证**

**审查清单**:
- [ ] 代码符合 TypeScript 严格模式
- [ ] 无安全漏洞（XSS、SQL 注入等）
- [ ] 遵循极简主义设计
- [ ] 性能优化到位
- [ ] 错误处理完善

**验收标准**:
- [ ] 代码审查通过
- [ ] 所有问题已修复

---

## 第六阶段: 部署与文档 (Deployment & Documentation)

### Task 6.1: 部署到生产环境
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 5.3

**描述**:
将功能部署到 Vercel 生产环境。

**要求**:
- 确保数据库迁移已应用
- 验证环境变量配置
- 执行冒烟测试（Smoke Test）

**验收标准**:
- [ ] 生产环境部署成功
- [ ] 功能正常运行
- [ ] 无明显错误

---

### Task 6.2: 更新项目文档
**状态**: ⬜ 未开始
**负责人**: [ASSIGNEE]
**估时**: [X 小时]
**依赖**: Task 6.1

**描述**:
更新用户手册、API 文档、技术文档（如需要）。

**输出**:
- README.md 更新（如有新功能说明）
- API 文档更新（如有新 API）

**验收标准**:
- [ ] 文档准确反映新功能
- [ ] 示例代码正确

---

## 完成检查清单 (Completion Checklist)

在标记整个功能为"已完成"前，确认以下所有项已完成：

### 功能完整性
- [ ] 所有任务状态为 `✅ 已完成`
- [ ] 功能符合规格说明书的所有要求
- [ ] 用户故事全部实现

### 宪章合规性
- [ ] **原则 1: 极简主义设计** - UI 简洁、符合 Apple 风格
- [ ] **原则 2: 安全优先** - RLS 策略和权限检查完善
- [ ] **原则 3: 强制质量保证** - 测试和审查通过
- [ ] **原则 4: 类型安全** - 无 TypeScript 错误、无 `any`
- [ ] **原则 5: 性能优先** - 使用 Server Components、无性能瓶颈
- [ ] **原则 6: 数据一致性** - 数据模型完整、外键正确

### 质量指标
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] 代码审查通过（无 Critical/High 问题）
- [ ] 权限测试通过（所有角色测试完成）
- [ ] 生产环境部署成功

---

## 备注与问题追踪 (Notes & Issue Tracking)

### 已知问题
| 问题 ID | 描述 | 优先级 | 状态 | 负责人 |
|---------|------|--------|------|--------|
| - | - | - | - | - |

### 技术债务
| 债务描述 | 影响 | 计划解决时间 |
|----------|------|--------------|
| - | - | - |

### 学习与改进
[记录在实施过程中的经验教训和改进建议]
